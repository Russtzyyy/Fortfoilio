<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flappy Cat (Responsive)</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background-color: #333446;
      color: #B8CFCE;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }

    /* Header: Top bar with back button and centered title */
    .header {
      width: 100%;
      height: 60px;
      background-color: #44455a;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      position: relative;
      box-sizing: border-box;
    }

    .title {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      font-size: 24px;
      color: #EAEFEF;
      user-select: none;
    }

    .back-btn {
      background: #7F8CAA;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      user-select: none;
    }

    .back-btn:hover {
      background: #6c7b96;
    }

    /* Game container */
    #game {
      position: relative;
      width: 90vw;
      max-width: 480px;
      aspect-ratio: 3 / 4;
      background: linear-gradient(to bottom, #87CEEB, #e0f7fa);
      overflow: hidden;
      border: 4px solid #7F8CAA;
      border-radius: 10px;
      margin-top: 20px;
      user-select: none;
    }

    #cat {
      position: absolute;
      font-size: 40px;
      transition: transform 0.1s;
      z-index: 2;
      user-select: none;
      /* top and left will be set dynamically */
    }

    .pipe {
      position: absolute;
      background: #4CAF50;
      border: 3px solid #2e7d32;
      box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.3);
      z-index: 1;
      /* width and height will be set dynamically */
    }

    .pipe::after {
      content: "";
      position: absolute;
      width: 70px;
      height: 20px;
      background: #2e7d32;
      border-radius: 5px;
      left: -5px;
      z-index: 2;
      pointer-events: none;
    }

    .pipe-top {
      top: 0;
    }

    .pipe-top::after {
      bottom: -20px;
    }

    .pipe-bottom {
      bottom: 0;
    }

    .pipe-bottom::after {
      top: -20px;
    }

    #score {
      position: absolute;
      top: 15px;
      left: 15px;
      font-size: 22px;
      font-weight: bold;
      z-index: 3;
      color: #fff;
      text-shadow: 1px 1px 2px #000;
      user-select: none;
    }

    #restart {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 10px 20px;
      background: #7F8CAA;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 18px;
      cursor: pointer;
      z-index: 4;
      user-select: none;
    }
  </style>
</head>
<body>
  <div class="header">
    <button class="back-btn" onclick="window.location.href='index.html'">‚Üê Back</button>
    <h1 class="title">üê± Flappy Cat</h1>
  </div>

  <div id="game">
    <div id="cat">üê±</div>
    <div id="score">Score: 0</div>
    <button id="restart">Restart</button>
  </div>

  <script>
    const game = document.getElementById('game');
    const cat = document.getElementById('cat');
    const scoreDisplay = document.getElementById('score');
    const restartBtn = document.getElementById('restart');

    const ORIGINAL_WIDTH = 480;
    const ORIGINAL_HEIGHT = 640;

    // Get scale relative to original design
    function getScale() {
      return game.clientWidth / ORIGINAL_WIDTH;
    }

    let scale = getScale();

    // Scaled game values
    let catWidth = 40 * scale; // approx width of cat emoji in px
    let catLeft = 50 * scale;
    let catTop = 200 * scale;

    let velocity = 0;
    const gravity = 0.5 * scale;
    const jumpVelocity = -8 * scale;

    let isGameOver = false;
    let score = 0;

    // Apply initial cat position and size
    function setCatPosition() {
      cat.style.left = catLeft + 'px';
      cat.style.top = catTop + 'px';
      cat.style.fontSize = (40 * scale) + 'px';
    }
    setCatPosition();

    function jump() {
      if (!isGameOver) {
        velocity = jumpVelocity;
        cat.style.transform = "rotate(-20deg)";
        setTimeout(() => cat.style.transform = "rotate(0deg)", 200);
      }
    }

    document.body.addEventListener('keydown', jump);
    document.body.addEventListener('click', jump);

    function intersects(r1, r2) {
      return !(r2.left > r1.right ||
               r2.right < r1.left ||
               r2.top > r1.bottom ||
               r2.bottom < r1.top);
    }

    function gameOver() {
      isGameOver = true;
      restartBtn.style.display = 'block';
    }

    restartBtn.addEventListener('click', () => location.reload());

    // Create pipe pairs
    function createPipe() {
      scale = getScale();

      const gap = 150 * scale;
      const pipeWidth = 60 * scale;
      const maxPipeHeight = game.clientHeight - gap - 50 * scale;
      const topHeight = Math.floor(Math.random() * maxPipeHeight) + 50 * scale;
      const bottomHeight = game.clientHeight - topHeight - gap;

      const topPipe = document.createElement('div');
      topPipe.className = 'pipe pipe-top';
      topPipe.style.height = topHeight + 'px';
      topPipe.style.width = pipeWidth + 'px';
      topPipe.style.left = game.clientWidth + 'px';

      const bottomPipe = document.createElement('div');
      bottomPipe.className = 'pipe pipe-bottom';
      bottomPipe.style.height = bottomHeight + 'px';
      bottomPipe.style.width = pipeWidth + 'px';
      bottomPipe.style.left = game.clientWidth + 'px';

      game.appendChild(topPipe);
      game.appendChild(bottomPipe);

      const moveSpeed = 3 * scale;

      const moveInterval = setInterval(() => {
        if (isGameOver) {
          clearInterval(moveInterval);
          topPipe.remove();
          bottomPipe.remove();
          return;
        }

        let left = parseFloat(topPipe.style.left);
        left -= moveSpeed;
        topPipe.style.left = bottomPipe.style.left = left + 'px';

        if (left <= catLeft && left > catLeft - moveSpeed) {
          score++;
          scoreDisplay.textContent = 'Score: ' + score;
        }

        if (left < -pipeWidth) {
          topPipe.remove();
          bottomPipe.remove();
          clearInterval(moveInterval);
        }

        const catRect = cat.getBoundingClientRect();
        const topRect = topPipe.getBoundingClientRect();
        const bottomRect = bottomPipe.getBoundingClientRect();
        const gameRect = game.getBoundingClientRect();

        if (
          intersects(catRect, topRect) ||
          intersects(catRect, bottomRect) ||
          catRect.bottom > gameRect.bottom ||
          catRect.top < gameRect.top
        ) {
          gameOver();
        }
      }, 20);
    }

    // Spawn pipes every 2 seconds
    setInterval(() => {
      if (!isGameOver) createPipe();
    }, 2000);

    // Main game loop
    function gameLoop() {
      velocity += gravity;
      catTop += velocity;

      // Keep cat within game bounds vertically
      const maxTop = game.clientHeight - cat.offsetHeight;
      if (catTop > maxTop) {
        catTop = maxTop;
        velocity = 0;
      }
      if (catTop < 0) {
        catTop = 0;
        velocity = 0;
      }

      cat.style.top = catTop + 'px';

      if (!isGameOver) {
        requestAnimationFrame(gameLoop);
      }
    }

    gameLoop();

    // Adjust scale on window resize
    window.addEventListener('resize', () => {
      scale = getScale();

      catWidth = 40 * scale;
      catLeft = 50 * scale;
      catTop = Math.min(catTop, game.clientHeight - catWidth); // Keep cat inside

      velocity = 0;

      cat.style.fontSize = (40 * scale) + 'px';
      cat.style.left = catLeft + 'px';
      cat.style.top = catTop + 'px';
    });
  </script>
</body>
</html>
