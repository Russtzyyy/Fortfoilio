<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Shell Game - Cup and Ball</title>
  <style>
    body {
      background: #333446;
      color: #B8CFCE;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px;
      min-height: 100vh;
      user-select: none;
    }
    #gameContainer {
      width: 400px;
      background: #222635;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 15px #7F8CAA;
      text-align: center;
    }
    h2 {
      margin-bottom: 20px;
    }
    #cups {
      display: flex;
      justify-content: space-around;
      margin: 20px 0 40px;
      perspective: 600px;
    }
    .cup {
      width: 80px;
      height: 100px;
      background: #7F8CAA;
      border-radius: 0 0 40px 40px;
      position: relative;
      cursor: pointer;
      box-shadow: inset 0 -5px 8px rgba(0,0,0,0.3);
      transition: transform 0.4s ease;
    }
    .cup:hover {
      filter: brightness(1.2);
    }
    .cup.selected {
      box-shadow: 0 0 15px #B8CFCE;
      filter: brightness(1.3);
    }
    .cup.shake {
      animation: shake 0.6s ease;
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0) rotate(0deg);}
      20% { transform: translateX(-10px) rotate(-5deg);}
      40% { transform: translateX(10px) rotate(5deg);}
      60% { transform: translateX(-10px) rotate(-5deg);}
      80% { transform: translateX(10px) rotate(5deg);}
    }
    .ball {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 30px;
      height: 30px;
      background: #EAEFEF;
      border-radius: 50%;
      box-shadow: 0 0 10px #B8CFCE;
      display: none;
    }
    #message {
      min-height: 50px;
      font-size: 1.2em;
      margin-bottom: 20px;
    }
    #shuffleBtn, #resetBtn, #backBtn {
      background: #B8CFCE;
      color: #333446;
      font-weight: bold;
      border: none;
      padding: 10px 25px;
      border-radius: 6px;
      cursor: pointer;
      margin: 10px 5px 0 5px;
      transition: background 0.3s;
    }
    #shuffleBtn:hover, #resetBtn:hover, #backBtn:hover {
      background: #EAEFEF;
    }
    #shuffleBtn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <h2>Shell Game - Guess the Cup with the Ball</h2>
    <div id="message">Click "Shuffle" to start the game.</div>
    <div id="cups">
      <div class="cup" data-index="0"><div class="ball"></div></div>
      <div class="cup" data-index="1"><div class="ball"></div></div>
      <div class="cup" data-index="2"><div class="ball"></div></div>
    </div>
    <button id="shuffleBtn">Shuffle</button>
    <button id="resetBtn" style="display:none;">Play Again</button>
    <button id="backBtn">Back</button>
  </div>

  <script>
    const cups = document.querySelectorAll('.cup');
    const message = document.getElementById('message');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const resetBtn = document.getElementById('resetBtn');
    const backBtn = document.getElementById('backBtn');

    let ballPosition = null;
    let isShuffling = false;
    let playerCanGuess = false;

    function placeBallRandomly() {
      cups.forEach(cup => {
        cup.querySelector('.ball').style.display = 'none';
      });
      ballPosition = Math.floor(Math.random() * 3);
    }

    function shuffleAnimation() {
      isShuffling = true;
      playerCanGuess = false;
      message.textContent = "Shuffling the cups...";
      shuffleBtn.disabled = true;

      let shakes = 6;
      let currentShake = 0;

      function shakeOnce() {
        cups.forEach(cup => cup.classList.add('shake'));
        setTimeout(() => {
          cups.forEach(cup => cup.classList.remove('shake'));
          currentShake++;
          if (currentShake < shakes) {
            setTimeout(shakeOnce, 300);
          } else {
            performSwaps(10);
          }
        }, 600);
      }

      shakeOnce();
    }

    function performSwaps(timesLeft) {
      if (timesLeft === 0) {
        isShuffling = false;
        playerCanGuess = true;
        message.textContent = "Now, pick the cup with the ball!";
        return;
      }
      let i = Math.floor(Math.random() * 3);
      let j;
      do {
        j = Math.floor(Math.random() * 3);
      } while (j === i);

      swapCups(i, j);
      setTimeout(() => {
        performSwaps(timesLeft - 1);
      }, 400);
    }

    function swapCups(i, j) {
      let orderI = cups[i].style.order || i;
      let orderJ = cups[j].style.order || j;

      cups[i].style.order = orderJ;
      cups[j].style.order = orderI;

      if (ballPosition === i) {
        ballPosition = j;
      } else if (ballPosition === j) {
        ballPosition = i;
      }
    }

    function revealBall(guessIndex) {
      cups.forEach((cup, idx) => {
        cup.querySelector('.ball').style.display = idx === ballPosition ? 'block' : 'none';
        cup.classList.remove('selected');
      });
      cups[guessIndex].classList.add('selected');

      playerCanGuess = false;
      shuffleBtn.style.display = 'none';
      resetBtn.style.display = 'inline-block';

      if (guessIndex === ballPosition) {
        message.textContent = "ðŸŽ‰ You won! The ball was under that cup!";
      } else {
        message.textContent = `ðŸ˜ž Wrong! The ball was under cup #${ballPosition + 1}. Try again!`;
      }
    }

    function resetGame() {
      cups.forEach(cup => {
        cup.style.order = "";
        cup.querySelector('.ball').style.display = 'none';
        cup.classList.remove('selected');
      });
      ballPosition = null;
      isShuffling = false;
      playerCanGuess = false;
      shuffleBtn.disabled = false;
      shuffleBtn.style.display = 'inline-block';
      resetBtn.style.display = 'none';
      message.textContent = 'Click "Shuffle" to start the game.';
    }

    cups.forEach((cup, idx) => {
      cup.addEventListener('click', () => {
        if (!playerCanGuess || isShuffling) return;
        revealBall(idx);
      });
    });

    shuffleBtn.addEventListener('click', () => {
      if (isShuffling) return;
      placeBallRandomly();
      shuffleAnimation();
    });

    resetBtn.addEventListener('click', resetGame);

    // âœ… BACK button returns to project section
    backBtn.addEventListener('click', () => {
      window.location.href = 'index.html#projectsSection';
    });

    resetGame();
  </script>
</body>
</html>
